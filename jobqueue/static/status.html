<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>WR Status</title>

    <!-- jQuery for various utility, and needed by bootstrap.js -->
    <script src="/js/jquery-2.2.4.min.js"></script>

    <!-- Bootstrap for presentation and styling -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/bootstrap-3.3.7.min.css">
    <script src="/js/bootstrap-3.3.7.min.js"></script>

    <!-- Knockout for event handling -->
    <script src="/js/knockout-3.4.0.min.js"></script>

    <!-- Knockstrap to make buttons and things work 2-way between knockout and bootstrap -->
    <script src="/js/knockstrap-1.3.2.min.js"></script>

    <!-- Main entry point for the status page (which imports all other modules) -->
    <script src="/js/main.js" type="module"></script>

    <link rel="stylesheet" href="/css/wr-0.0.1.css">
</head>

<body>
    <!-- ====================== NAVIGATION BAR ====================== -->
    <div id="nav" class="navbar navbar-default" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <span class="navbar-brand">WR Status</span>
            </div>
        </div>
    </div>

    <div id="status" class="container">
        <!-- ====================== ERROR MESSAGES SECTION ====================== -->
        <div id="statuserrors" data-bind="foreach: statuserror">
            <div class="alert alert-danger fade in">
                <p data-bind="text: $data"></p>
            </div>
        </div>

        <!-- ====================== BAD SERVERS SECTION ====================== -->
        <div id="badservers" data-bind="foreach: badservers">
            <div class="alert alert-danger fade in">
                <div class="panel panel-warning">
                    <div class="panel-heading">
                        Server
                        <!-- ko if: Problem == "" -->
                        <u class="dotted"
                            data-bind="tooltip: { title: 'If this is just a temporary connectivity issue, this message will go away by itself.' }">might
                            be dead</u>
                        <!-- /ko -->
                        <!-- ko if: !Problem == "" -->
                        <u class="dotted"
                            data-bind="tooltip: { title: 'There was a problem using this server. It will not be used to run other jobs. Investigate it manually if you like, before hitting the `Kill it` button.' }">is
                            no longer usable</u>
                        <!-- /ko -->
                    </div>
                    <div class="panel-body">
                        Name: <span data-bind="text: Name"></span><br>
                        ID: <span data-bind="text: ID"></span><br>
                        IP: <span data-bind="text: IP"></span><br>
                        <!-- ko if: Problem == "" -->
                        Lost contact: <span data-bind="text: Date.toDate()"></span>
                        <button type="button" class="btn btn-danger pull-right"
                            data-bind="click: $root.confirmDeadServer">It's really dead</button>
                        <!-- /ko -->
                        <!-- ko if: !Problem == "" -->
                        Problem encountered: <span data-bind="text: Problem"></span><br>
                        Problem encountered at: <span data-bind="text: Date.toDate()"></span>
                        <button type="button" class="btn btn-danger pull-right"
                            data-bind="click: $root.confirmDeadServer">Kill it</button>
                        <!-- /ko -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ====================== SYSTEM MESSAGES SECTION ====================== -->
        <!-- ko if: messages().length > 1 -->
        <button type="button" class="btn btn-warning pull-right" data-bind="click: $root.dismissMessages">Dismiss
            All</button>
        <!-- /ko -->
        <!-- ko if: messages().length > 0 -->
        <div class="alert alert-danger fade in">
            <div id="messages" data-bind="foreach: messages">
                <div class="panel panel-warning">
                    <div class="panel-heading">
                        Scheduler Issue
                        <!-- ko if: Count() > 1 -->
                        [first reported at: <span data-bind="text: FirstDate.toDate()"></span>]
                        <!-- /ko -->
                    </div>
                    <div class="panel-body">
                        <span data-bind="text: Msg"></span><br>
                        Reported at: <span data-bind="text: LastDate().toDate()"></span>
                        <!-- ko if: Count() > 1 -->
                        <br>Reported: <span data-bind="text: Count"></span> times
                        <!-- /ko -->
                        <button type="button" class="btn btn-warning pull-right"
                            data-bind="click: $root.dismissMessage">Dismiss</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- /ko -->

        <!-- ====================== IN-FLIGHT JOBS SUMMARY ====================== -->
        <div style="width: 100%;" class="well well-sm top-margin">
            <div style="margin: 0 auto;">
                <h5 style="margin: 0; padding: 0">Incomplete <span class="badge"
                        data-bind="text: inflight.total"></span></h5>
                <div class="top-margin" data-bind="if: inflight.total() > 0">
                    <div class="progress" style="margin-bottom: 0">
                        <div class="progress-bar progress-bar-striped active progress-bar-warning" role="progressbar"
                            data-bind="style: { width: inflight.delayPct() + '%' }">
                            <!-- ko if: inflight.delayed() > 0 -->
                            <span data-bind="text: inflight.delayed"></span> delayed
                            <!-- /ko -->
                        </div>
                        <div class="progress-bar progress-bar-striped active progress-bar-warning" role="progressbar"
                            data-bind="style: { width: inflight.dependentPct() + '%' }">
                            <!-- ko if: inflight.dependent() > 0 -->
                            <span data-bind="text: inflight.dependent"></span> dependent
                            <!-- /ko -->
                        </div>
                        <div class="progress-bar progress-bar-striped active progress-bar-info" role="progressbar"
                            data-bind="style: { width: inflight.readyPct() + '%' }">
                            <!-- ko if: inflight.ready() > 0 -->
                            <span data-bind="text: inflight.ready"></span> pending
                            <!-- /ko -->
                        </div>
                        <div class="progress-bar progress-bar-striped active" role="progressbar"
                            data-bind="style: { width: inflight.runPct() + '%' }">
                            <!-- ko if: inflight.running() > 0 -->
                            <span data-bind="text: inflight.running"></span> running
                            <!-- /ko -->
                        </div>
                        <div class="progress-bar progress-bar-striped active progress-bar-danger" role="progressbar"
                            data-bind="style: { width: inflight.lostPct() + '%' }">
                            <!-- ko if: inflight.lost() > 0 -->
                            <span data-bind="text: inflight.lost"></span> lost contact
                            <!-- /ko -->
                        </div>
                        <div class="progress-bar progress-bar-danger" role="progressbar"
                            data-bind="style: { width: inflight.buryPct() + '%' }">
                            <!-- ko if: inflight.buried() > 0 -->
                            <span data-bind="text: inflight.buried"></span> buried
                            <!-- /ko -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ====================== REP GROUP SEARCH ====================== -->
        <!-- *** not yet implemented
            <div class="row bottom-margin">
                <div class="col-xs-5">
                    <form data-bind="submit: requestRepGroup">
                        <div class="input-group">
                            <span class="input-group-addon" data-toggle="tooltip" data-container="body" title="Enter an identifier to also see the status of all commands added with that identifier.">identifier</span>
                            <input type="text" class="form-control" data-bind="value: repGroup">
                            <span class="input-group-btn">
                                <button class="btn btn-default" type="submit"><span class="glyphicon glyphicon-play-circle"></span></button>
                            </span>
                        </div>
                    </form>
                </div>
            </div>
            -->

        <!-- ====================== REP GROUPS SECTION ====================== -->
        <!-- ko if: sortableRepGroups().length > 0 -->
        <hr>
        <!-- /ko -->

        <div data-bind="foreach: sortableRepGroups().sort(function(l,r) { return l.id > r.id ? 1 : -1 })">
            <div style="width: 100%;" class="well well-sm">
                <div style="margin: 0 auto;">
                    <h5 style="margin: 0; padding: 0"><span data-bind="text: id"></span> <span class="badge"
                            data-bind="text: total"></span></h5>
                    <div class="top-margin" data-bind="if: total() > 0">
                        <div class="progress" style="margin-bottom: 0">
                            <div class="progress-bar progress-bar-striped active progress-bar-warning clickable"
                                role="progressbar" aria-valuemin="0" aria-valuemax="100"
                                data-bind="style: { width: delayPct() + '%' }, click: $parent.showRepgroupDelayed, attr: { 'aria-valuenow': delayPct() }">
                                <!-- ko if: delayed() > 0 -->
                                <span data-bind="text: delayed"></span> delayed
                                <!-- /ko -->
                            </div>
                            <div class="progress-bar progress-bar-striped active progress-bar-warning clickable"
                                role="progressbar" aria-valuemin="0" aria-valuemax="100"
                                data-bind="style: { width: dependentPct() + '%' }, click: $parent.showRepgroupDependent, attr: { 'aria-valuenow': dependentPct() }">
                                <!-- ko if: dependent() > 0 -->
                                <span data-bind="text: dependent"></span> dependent
                                <!-- /ko -->
                            </div>
                            <div class="progress-bar progress-bar-striped active progress-bar-info clickable"
                                role="progressbar" aria-valuemin="0" aria-valuemax="100"
                                data-bind="style: { width: readyPct() + '%' }, click: $parent.showRepgroupReady, attr: { 'aria-valuenow': readyPct() }">
                                <!-- ko if: ready() > 0 -->
                                <span data-bind="text: ready"></span> pending
                                <!-- /ko -->
                            </div>
                            <div class="progress-bar progress-bar-striped active clickable" role="progressbar"
                                aria-valuemin="0" aria-valuemax="100"
                                data-bind="style: { width: runPct() + '%' }, click: $parent.showRepgroupRunning, attr: { 'aria-valuenow': runPct() }">
                                <!-- ko if: running() > 0 -->
                                <span data-bind="text: running"></span> running
                                <!-- /ko -->
                            </div>
                            <div class="progress-bar progress-bar-striped active progress-bar-danger clickable"
                                role="progressbar" aria-valuemin="0" aria-valuemax="100"
                                data-bind="style: { width: lostPct() + '%' }, click: $parent.showRepgroupLost, attr: { 'aria-valuenow': lostPct() }">
                                <!-- ko if: lost() > 0 -->
                                <span data-bind="text: lost"></span> lost contact
                                <!-- /ko -->
                            </div>
                            <div class="progress-bar progress-bar-danger clickable" role="progressbar" aria-valuemin="0"
                                aria-valuemax="100"
                                data-bind="style: { width: buryPct() + '%' }, click: $parent.showRepgroupBuried, attr: { 'aria-valuenow': buryPct() }">
                                <!-- ko if: buried() > 0 -->
                                <span data-bind="text: buried"></span> buried
                                <!-- /ko -->
                            </div>
                            <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuemin="0"
                                aria-valuemax="100"
                                data-bind="style: { width: deletePct() + '%' }, attr: { 'aria-valuenow': deletePct() }">
                                <!-- ko if: deleted() > 0 -->
                                <span data-bind="text: deleted"></span> deleted
                                <!-- /ko -->
                            </div>
                            <div class="progress-bar progress-bar-success clickable" role="progressbar"
                                aria-valuemin="0" aria-valuemax="100"
                                data-bind="style: { width: completePct() + '%' }, click: $parent.showRepgroupComplete, attr: { 'aria-valuenow': completePct() }">
                                <!-- ko if: complete() > 0 -->
                                <span data-bind="text: complete"></span> complete
                                <!-- /ko -->
                            </div>
                        </div>
                    </div>

                    <!-- ====================== JOB DETAILS PANEL ====================== -->
                    <!-- ko foreach: details -->
                    <div class="top-margin panel" style="margin-bottom: 0"
                        data-bind="css: { 'panel-warning': State == 'delayed' || State == 'dependent', 'panel-info': State == 'ready' || State == 'running', 'panel-danger': State == 'buried' || State == 'lost', 'panel-success': State == 'complete' }">
                        <div class="panel-heading">
                            <div class="terminal"
                                data-bind="css: { 'border-warning': State == 'delayed' || State == 'dependent', 'border-info': State == 'ready', 'border-primary': State == 'running', 'border-danger': State == 'buried' || State == 'lost', 'border-success': State == 'complete' }">
                                <small>
                                    <div class="command-path"
                                        data-bind="attr: {'data-expanded': false}, click: $root.togglePathExpansion">
                                        @<span data-bind="text: Host" style="color: #00FF00;"></span>:
                                        <span data-bind="text: CwdBase" style="color: #FFFF00;"></span><span
                                            data-bind="text: Cwd" style="color:#E5C700"></span>
                                    </div>

                                    <!-- ko if: WithDocker != '' -->
                                    <i>docker image:</i> <span data-bind="text: WithDocker"></span>
                                    <!-- /ko -->
                                    <!-- ko if: WithSingularity != '' -->
                                    <i>singularity image:</i> <span data-bind="text: WithSingularity"></span>
                                    <!-- /ko -->
                                    <!-- ko if: Mounts -->
                                    <i>mounts:</i> <span data-bind="text: Mounts"></span>
                                    <!-- /ko -->
                                    <!-- ko if: ContainerMounts -->
                                    <i>container mounts:</i> <span data-bind="text: ContainerMounts"></span>
                                    <!-- /ko -->
                                </small>

                                <h5 style="margin: 0; padding: 0">$ <span data-bind="text: Cmd"></span></h5>

                                <!-- ko if: StdOut -->
                                <div class="output-divider">
                                    <span class="output-label stdout-label">STDOUT</span>
                                </div>
                                <span data-bind="text: StdOut" class="stdout-text"></span>
                                <!-- /ko -->
                                <!-- ko if: StdErr -->
                                <div class="output-divider">
                                    <span class="output-label stderr-label">STDERR</span>
                                </div>
                                <span data-bind="text: StdErr" class="stderr-text"></span>
                                <!-- /ko -->
                            </div>
                        </div>

                        <!-- ====================== JOB PROPERTIES SECTION ====================== -->
                        <div class="panel-body compact-props">
                            <!-- Core Properties (always visible) -->
                            <div class="prop-section resources">
                                <div class="prop-tag">
                                    <span class="prop-name">Cores</span>
                                    <span class="prop-value" data-bind="text: Cores"></span>
                                </div>

                                <div class="prop-tag">
                                    <span class="prop-name">RAM</span>
                                    <span class="prop-value">
                                        <span data-bind="text: ExpectedRAM.mbIEC()"></span>
                                        <!-- ko if: Exited && PeakRAM > 0 -->
                                        <span class="prop-separator">→</span>
                                        <span class="actual-value"
                                            data-bind="text: PeakRAM.mbIEC(), css: { 'over-limit': PeakRAM > ExpectedRAM }"></span>
                                        <!-- /ko -->
                                    </span>
                                </div>

                                <div class="prop-tag">
                                    <span class="prop-name">Time</span>
                                    <span class="prop-value">
                                        <span data-bind="text: ExpectedTime.toDuration()"></span>

                                        <!-- ko if: Exited -->
                                        <span class="prop-separator">→</span>
                                        <span class="actual-value"
                                            data-bind="text: Walltime.toDuration(), css: { 'over-limit': Walltime > ExpectedTime }"></span>
                                        <span class="prop-separator">•</span>
                                        <span class="cpu-time" data-bind="text: 'CPU: ' + CPUtime.toDuration()"></span>
                                        <!-- /ko -->

                                        <!-- ko if: !Exited && (State == 'running' || State == 'reserved') -->
                                        <span class="prop-separator">→</span>
                                        <span class="actual-value"
                                            data-bind="text: LiveWalltime().toDuration(), css: { 'over-limit': LiveWalltime() > ExpectedTime }"></span>
                                        <!-- /ko -->

                                        <!-- ko if: !Exited && State == 'lost' -->
                                        <span class="prop-separator">→</span>
                                        <span class="actual-value"
                                            data-bind="text: Walltime.toDuration(), css: { 'over-limit': Walltime > ExpectedTime }"></span>
                                        <!-- /ko -->
                                    </span>
                                </div>

                                <!-- Disk (conditional) -->
                                <div class="prop-tag" data-bind="if: RequestedDisk > 0">
                                    <span class="prop-name">Disk</span>
                                    <span class="prop-value">
                                        <span data-bind="text: RequestedDisk + ' GB'"></span>
                                        <!-- ko if: Exited && PeakDisk > 0 -->
                                        <span class="prop-separator">→</span>
                                        <span class="actual-value"
                                            data-bind="text: PeakDisk.mbIEC(), css: { 'over-limit': PeakDisk > (RequestedDisk * 1024) }"></span>
                                        <!-- /ko -->
                                    </span>
                                </div>

                                <!-- Docker (conditional) -->
                                <!-- ko if: MonitorDocker != '' -->
                                <div class="prop-tag docker">
                                    <span class="prop-name">Docker</span>
                                    <span class="prop-value" data-bind="text: MonitorDocker"></span>
                                </div>
                                <!-- /ko -->
                            </div>

                            <!-- Combined status section -->
                            <div class="prop-section">
                                <!-- Status - combines attempts, exit code, and failure reason -->
                                <div class="prop-tag wide-tag">
                                    <span class="prop-name">Status</span>
                                    <span class="prop-value">
                                        <span data-bind="text: 'Attempt ' + Attempts"></span>

                                        <!-- ko if: Exited -->
                                        <span class="prop-separator">•</span>
                                        <span class="exit-code"
                                            data-bind="text: 'Exit: ' + Exitcode, css: { 'exit-success': Exitcode == 0, 'exit-error': Exitcode != 0 }"></span>
                                        <!-- /ko -->

                                        <!-- ko if: FailReason -->
                                        <span class="prop-separator">•</span>
                                        <span class="fail-reason truncate-text"
                                            data-bind="text: FailReason, attr: { title: FailReason }"></span>
                                        <!-- /ko -->
                                    </span>
                                </div>
                            </div>

                            <!-- Execution information -->
                            <div class="prop-section">
                                <!-- Started/Ended dates -->
                                <div class="prop-tag wide-tag">
                                    <span class="prop-name">When</span>
                                    <span class="prop-value">
                                        <span data-bind="text: 'Started: ' + Started.toDate()"></span>
                                        <!-- ko if: Exited -->
                                        <span class="prop-separator">→</span>
                                        <span data-bind="text: 'Ended: ' + Ended.toDate()"></span>
                                        <!-- /ko -->
                                    </span>
                                </div>

                                <!-- Combined host information -->
                                <div class="prop-tag wide-tag host">
                                    <span class="prop-name">Where</span>
                                    <span class="prop-value">
                                        <span data-bind="text: Host"></span>
                                        <span class="prop-separator">•</span>
                                        <span data-bind="text: 'IP: ' + HostIP"></span>
                                        <!-- ko if: HostID != "" -->
                                        <span class="prop-separator">•</span>
                                        <span data-bind="text: 'ID: ' + HostID"></span>
                                        <!-- /ko -->
                                        <span class="prop-separator">•</span>
                                        <span data-bind="text: 'PID: ' + Pid"></span>
                                    </span>
                                </div>

                                <!-- Individual advanced properties buttons -->
                                <div class="prop-section advanced">
                                    <!-- ko if: LimitGroups && LimitGroups.length > 0 -->
                                    <div class="prop-tag clickable" data-bind="click: $root.showLimitGroups">
                                        <span class="prop-name">LG</span>
                                        <span class="prop-value"><i class="glyphicon glyphicon-eye-open"></i></span>
                                    </div>
                                    <!-- /ko -->

                                    <!-- ko if: DepGroups && DepGroups.length > 0 -->
                                    <div class="prop-tag clickable" data-bind="click: $root.showDepGroups">
                                        <span class="prop-name">DG</span>
                                        <span class="prop-value"><i class="glyphicon glyphicon-eye-open"></i></span>
                                    </div>
                                    <!-- /ko -->

                                    <!-- ko if: Dependencies && Dependencies.length > 0 -->
                                    <div class="prop-tag clickable" data-bind="click: $root.showDependencies">
                                        <span class="prop-name">Deps</span>
                                        <span class="prop-value"><i class="glyphicon glyphicon-eye-open"></i></span>
                                    </div>
                                    <!-- /ko -->

                                    <!-- ko if: Behaviours -->
                                    <div class="prop-tag clickable" data-bind="click: $root.showBehaviours">
                                        <span class="prop-name">Beh</span>
                                        <span class="prop-value"><i class="glyphicon glyphicon-eye-open"></i></span>
                                    </div>
                                    <!-- /ko -->

                                    <!-- ko if: OtherRequests && OtherRequests.length > 0 -->
                                    <div class="prop-tag clickable" data-bind="click: $root.showOther">
                                        <span class="prop-name">Reqs</span>
                                        <span class="prop-value"><i class="glyphicon glyphicon-eye-open"></i></span>
                                    </div>
                                    <!-- /ko -->

                                    <div class="prop-tag clickable" data-bind="click: $root.showInternalID">
                                        <span class="prop-name">ID</span>
                                        <span class="prop-value"><i class="glyphicon glyphicon-eye-open"></i></span>
                                    </div>

                                    <!-- ko if: Env && Env.length > 0 -->
                                    <div class="prop-tag clickable" data-bind="click: $root.showEnv">
                                        <span class="prop-name">Env</span>
                                        <span class="prop-value"><i class="glyphicon glyphicon-eye-open"></i></span>
                                    </div>
                                    <!-- /ko -->
                                </div>
                            </div>
                        </div>

                        <!-- ====================== JOB ACTION BUTTONS ====================== -->
                        <div class="panel-footer clearfix">
                            <!-- ko if: Similar -->
                            + <span data-bind="text: Similar"></span> other commands
                            <!-- ko if: Exited && Exitcode != 0 -->
                            with same exit code (<span data-bind="text: Exitcode"></span>) and reason for failure
                            <!-- /ko -->
                            <button type="button" class="btn btn-sm btn-info"
                                data-bind="click: $root.loadMoreJobs, visible: Similar > 0">
                                Load more
                            </button>
                            <!-- /ko -->
                            <!-- ko if: State == "delayed" -->
                            <button type="button" class="btn btn-danger pull-right"
                                data-bind="click: $root.confirmRemoveDelay">Remove</button>
                            <!-- /ko -->
                            <!-- ko if: State == "ready" -->
                            <button type="button" class="btn btn-danger pull-right"
                                data-bind="click: $root.confirmRemovePend">Remove</button>
                            <!-- /ko -->
                            <!-- ko if: State == "dependent" -->
                            <button type="button" class="btn btn-danger pull-right"
                                data-bind="click: $root.confirmRemoveDep">Remove</button>
                            <!-- /ko -->
                            <!-- ko if: State == "running" -->
                            <button type="button" class="btn btn-danger pull-right"
                                data-bind="click: $root.confirmKill">Kill</button>
                            <!-- /ko -->
                            <!-- ko if: State == "lost" -->
                            <small>This job appears dead, but this could be due to a temporary issue such as a
                                networking failure; if the job is actually fine, it will revert to running state
                                automatically when the problem is fixed.</small><br>
                            <button type="button" class="btn btn-danger pull-right"
                                data-bind="click: $root.confirmDead">Confirm Dead</button>
                            <!-- /ko -->
                            <!-- ko if: State == "buried" -->
                            <div class="btn-group pull-right">
                                <button type="button" class="btn btn-danger"
                                    data-bind="click: $root.confirmRemoveFail">Remove</button>
                                <button type="button" class="btn btn-primary"
                                    data-bind="click: $root.confirmRetry">Retry</button>
                            </div>
                            <!-- /ko -->
                        </div>
                    </div>
                    <!-- /ko -->
                </div>
            </div>
        </div>

        <!-- ====================== MODAL DIALOGS ====================== -->
        <!-- action modals -->
        <div data-bind="modal: {
                visible: actionModalVisible,
                dialogCss: 'modal-sm',
                header: { data: { label: actionModalHeader } },
                body: { name: 'actionModalBodyTemplate', data: actionDetails },
                footer: { name: 'actionModalFooterTemplate', data: actionDetails }
            }"></div>
        <script type="text/html" id="actionModalBodyTemplate">
                <!-- ko if: button() != "confirm" -->
                Are you sure you want to <span data-bind="text: action"></span> the <span data-bind="text: count"></span>
        commands with the identifier "<span data-bind="text: repGroup"></span>"
        <!-- ko if: exited -->
        that had exit code <span data-bind="text: exitCode"></span> and failed because "<span
            data-bind="text: failReason"></span>"?
        <!-- /ko -->
        <!-- ko if: ! exited -->
        ?
        <!-- /ko -->
        <!-- /ko -->
        <!-- ko if: button() == "confirm" -->
        Are you sure the <span data-bind="text: count"></span> commands with the identifier "<span
            data-bind="text: repGroup"></span>" are really dead?
        <!-- /ko -->
        <br>
        <!-- ko if: button() == "kill" -->
        <small>(there will be a delay before the cmds stop executing; after killing wait until the jobs become
            buried)</small>
        <!-- /ko -->
        <!-- ko if: button() == "remove" -->
        <small>(removal of commands that have other commands depending on them will silently fail)</small>
        <!-- /ko -->
        </script>
        <script type="text/html" id="actionModalFooterTemplate">
            <div class="btn-group">
                <!-- ko if: count() > 1 -->
                    <button type="button" class="btn btn-primary" data-bind="click: $root.commitAction.bind($data, true), text: button().capitalizeFirstLetter() + ' all'"></button>
                    <button type="button" class="btn btn-primary" data-bind="click: $root.commitAction.bind($data, false), text: button().capitalizeFirstLetter() + ' 1'"></button>
                <!-- /ko -->
                <!-- ko if: count() == 1 -->
                    <button type="button" class="btn btn-primary" data-bind="click: $root.commitAction.bind($data, false), text: button().capitalizeFirstLetter()"></button>
                <!-- /ko -->
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            </div>
        </script>

        <!-- Individual component modals (kept for backward compatibility) -->
        <div data-bind="modal: {
                visible: lgModalVisible,
                dialogCss: 'modal-lg',
                header: { data: { label: 'Limit Groups' } },
                body: { name: 'envModalBodyTemplate', data: lgVars }
            }"></div>

        <div data-bind="modal: {
                visible: dgModalVisible,
                dialogCss: 'modal-lg',
                header: { data: { label: 'Dependency Groups' } },
                body: { name: 'envModalBodyTemplate', data: dgVars }
            }"></div>

        <div data-bind="modal: {
                visible: depModalVisible,
                dialogCss: 'modal-lg',
                header: { data: { label: 'Dependencies' } },
                body: { name: 'envModalBodyTemplate', data: depVars }
            }"></div>

        <div data-bind="modal: {
                visible: behModalVisible,
                dialogCss: 'modal-lg',
                header: { data: { label: 'Behaviours' } },
                body: { name: 'envModalBodyTemplate', data: behVars }
            }"></div>

        <div data-bind="modal: {
                visible: otherModalVisible,
                dialogCss: 'modal-lg',
                header: { data: { label: 'Other Resource Requirements' } },
                body: { name: 'envModalBodyTemplate', data: otherVars }
            }"></div>

        <div data-bind="modal: {
                visible: internalModalVisible,
                dialogCss: 'modal-lg',
                header: { data: { label: 'Internal Job ID' } },
                body: { name: 'envModalBodyTemplate', data: internalVars }
            }"></div>

        <div data-bind="modal: {
                visible: envModalVisible,
                dialogCss: 'modal-lg',
                header: { data: { label: 'Environment Variables' } },
                body: { name: 'envModalBodyTemplate', data: envVars }
            }"></div>
        <script type="text/html" id="envModalBodyTemplate">
                <div data-bind="foreach: $data">
                    <span data-bind="text: $data"></span><br>
                </div>
            </script>

        <hr>

        <!-- ====================== FOOTER ====================== -->
        <footer id="footer">
            <small>&copy; 2016-2021 Genome Research Limited.</small>
        </footer>
    </div>
</body>

</html>